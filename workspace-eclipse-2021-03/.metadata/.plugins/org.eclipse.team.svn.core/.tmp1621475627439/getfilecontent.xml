<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="edcAtnlcMngr">

<typeAlias alias="edcAtnlcMngrVO" type="kr.co.hanshinit.NeoEdu.cop.edcAtnlcMngr.service.EdcAtnlcMngrVO" />
<typeAlias alias="edcAtnlcMngr" type="kr.co.hanshinit.NeoEdu.cop.edcAtnlcMngr.service.EdcAtnlcMngr" />
<typeAlias alias="edcAtnlcMngrEstn" type="kr.co.hanshinit.NeoEdu.cop.edcAtnlcMngr.service.EdcAtnlcMngrEstn" />

<typeAlias alias="edcAtnlcLctreVO" type="kr.co.hanshinit.NeoEdu.cop.edcAtnlcMngr.service.EdcAtnlcLctreVO" />

<!-- 강좌 접수 제한 방법 및 접수인원 수 조회 관련  -->
<typeAlias alias="edcLctreRstrctCndVO" type="kr.co.hanshinit.NeoEdu.cop.edcAtnlcMngr.service.EdcLctreRstrctCndVO" />


<typeAlias alias="cmmnPaylogVO" type="kr.co.hanshinit.NeoCop.cop.cmmnPaylog.service.CmmnPaylogVO" />

<resultMap id="edcAtnlcMngrMap" class="kr.co.hanshinit.NeoEdu.cop.edcAtnlcMngr.service.EdcAtnlcMngr">
	<result property="atnclKey" column="ATNCL_KEY"/>								<!-- 수강신청 KEY -->
	<result property="atnclNo" column="ATNCL_NO"/>								<!-- 수강번호 -->
	<result property="lctreKey" column="LCTRE_KEY"/>									<!-- 강좌기본 KEY -->
	<result property="lctreNm" column="LCTRE_NM"/>								<!-- 강좌명 -->
	<result property="userId" column="USER_ID"/>										<!-- 수강자아아디 -->
	<result property="diCode" column="DI_CODE"/>									<!-- 수강자 본인인증 key -->
	<result property="sortNo" column="SORT_NO"/>									<!-- 강좌과정번호-교육상세번호 -->
	<result property="userNm" column="USER_NM"/>									<!-- 신청자명 -->
	<result property="userSexdstn" column="USER_SEXDSTN"/>						<!-- 신청자성별 -->
	<result property="userBrthdy" column="USER_BRTHDY"/>							<!-- 신청자 생년월일 -->
	<result property="userTel" column="USER_TEL"/>									<!-- 신청자 연락처 -->
	<result property="userEmail" column="USER_EMAIL"/>								<!-- 신청자 이메일 -->
	<result property="zip" column="ZIP"/>												<!-- 신청자 우편번호 -->
	<result property="adres" column="ADRES"/>											<!-- 신청자 주소 1 -->
	<result property="adresDetail" column="ADRES_DETAIL"/>						<!-- 신청자 주소2 -->
	<result property="userRceptSttus" column="USER_RCEPT_STTUS"/>				<!-- 접수상태 -->
	<result property="setleSttus" column="SETLE_STTUS"/>							<!-- 결재상태 -->
	<result property="rceptYear" column="RCEPT_YEAR"/>							<!-- 접수년 -->
	<result property="rceptMt" column="RCEPT_MT"/>									<!-- 접수월 -->
	<result property="rceptDay" column="RCEPT_DAY"/>								<!-- 접수일 -->
	<result property="rceptTime" column="RCEPT_TIME"/>							<!-- 접수시간 -->
	<result property="rceptDe" column="RCEPT_DE"/>									<!-- 접수날짜 -->
	<result property="rceptMth" column="RCEPT_MTH"/>							<!-- 접수방법 -->
	<result property="rceptNmpr" column="RCEPT_NMPR"/>						<!-- 접수인원 -->
	<result property="agncyRceptYn" column="AGNCY_RCEPT_YN"/>		<!-- 대리접수여부 -->
	<result property="edcTime" column="EDC_TIME"/>								<!-- 교육시간 -->
	<result property="setleAmount" column="SETLE_AMOUNT"/>				<!-- 결제금액 -->
	<result property="dscntYn" column="DSCNT_YN"/>								<!-- 할인대상 여부 -->
	<result property="confmDe" column="CONFM_DE"/>								<!-- 승인일자 -->
	<result property="cancelDe" column="CANCEL_DE"/>							<!-- 취소일자 -->

	<result property="frstRegisterPnttm" column="FRST_REGISTER_PNTTM"/>		<!-- 최초등록일시 -->
	<result property="frstRegisterId" column="FRST_REGISTER_ID"/>						<!-- 최초등록자ID -->
	<result property="frstRegisterIp" column="FRST_REGISTER_IP"/>						<!-- 최초등록자IP -->
	<result property="lastUpdusrPnttm" column="LAST_UPDUSR_PNTTM"/>			<!-- 최종수정시점 -->
	<result property="lastUpdusrId" column="LAST_UPDUSR_ID"/>							<!-- 최종수정자ID -->
	<result property="lastUpdusrIp" column="LAST_UPDUSR_IP"/>							<!-- 최종수정자IP -->

	<result property="confmHmpgReflctAt" column="CONFM_HMPG_REFLCT_AT"/>		<!-- 최종수정자IP -->

	<result property="userMobile" 		column="USER_MOBILE"/>
	<result property="edcBgnde" 		column="EDC_BGNDE"/>
	<result property="edcEndde" 		column="EDC_ENDDE"/>
	<result property="edcSttus" 		column="EDC_STTUS"/>
	<result property="setleAmount" 	column="SETLE_AMOUNT"/>
	<result property="etcCt" 				column="ETC_CT"/>
	<result property="smsYn" 			column="SMS_YN"/>

	<result property="rcpmnyNm" 		column="RCPMNY_NM"/>
	<result property="metpay" 			column="METPAY"/>
	<result property="memo" 			column="MEMO"/>
	<result property="mberSe" 			column="MBER_SE"/>
	<result property="etcCtYn" 			column="ETC_CT_YN"/>
	<result property="insttCode" 				column="INSTT_CODE"/>
	<result property="rceptSttusAutoAt" 	column="RCEPT_STTUS_AUTO_AT"/>
	<result property="cancelYn" 	column="CANCEL_YN"/>

</resultMap>

<resultMap id="edcAtnlcMngrMap1" class="kr.co.hanshinit.NeoEdu.cop.edcAtnlcMngr.service.EdcAtnlcMngr" extends="edcAtnlcMngrMap">
	<result property="atnlcUserNm" 	column="ATNLC_USER_NM"/>
	<result property="atnlcUserTel" 	column="ATNLC_USER_TEL"/>
</resultMap>

<resultMap id="edcAtnlcLctreMap" class="kr.co.hanshinit.NeoEdu.cop.edcAtnlcMngr.service.EdcAtnlcLctreVO">
			<result property="lctreKey" 					column="LCTRE_KEY"/>							<!-- 수강신청 KEY -->
			<result property="lctreNm" 					column="LCTRE_NM"/>							<!-- 교육과정명 -->
			<result property="insttCode" 				column="INSTT_CODE"/>							<!-- 기관코드 -->
			<result property="useAt" 					column="USE_AT"/>								<!-- 사용유무 -->
			<result property="freeYn" 					column="FREE_YN"/>								<!-- 유료 무료 유무 -->
			<result property="atnclCt" 					column="ATNCL_CT"/>							<!-- 유료시 가격-->
			<result property="lctreLclas" 				column="LCTRE_LCLAS"/>						<!-- 강좌 대분류 코드 -->
			<result property="priorRceptBgnde" 		column="PRIOR_RCEPT_BGNDE"/>				<!-- 우선접수 기간 시작일-->
			<result property="priorRceptEndde" 		column="PRIOR_RCEPT_ENDDE"/>				<!-- 우선접수 기간 종료일-->
			<result property="rceptBgnde"  			column="RCEPT_BGNDE"/>						<!-- 모집기간 시작일 -->
			<result property="rceptEndde" 				column="RCEPT_ENDDE"/>						<!-- 모집기간 종료일 -->
			<result property="edcBgnde" 				column="EDC_BGNDE"/>							<!-- 교육 기간 시작일 -->
			<result property="edcEndde" 				column="EDC_ENDDE"/>							<!-- 교육 기간 종료일  -->
			<result property="rceptMth" 				column="RCEPT_MTH"/>							<!-- 모집 방법-선착순, 추첨, 승인, 관리자 선발 -->
			<result property="rceptSttus" 				column="RCEPT_STTUS"/>						<!-- 강좌 상태_강좌준비, 모집대기, 모집중, 모집마감 등 -->
			<result property="edcSttus" 				column="EDC_STTUS"/>							<!-- 교육상태, 교육대기, 교육중, 교육완료 등 -->

			<result property="rcritNmpr" 				column="RCRIT_NMPR"/>							<!-- 	모집인원	-->
			<result property="waitNmpr" 				column="WAIT_NMPR"/>							<!-- 대기인원	-->
			<result property="onlineNmpr" 				column="ONLINE_NMPR"/>						<!-- 온라인 접수인원	-->
			<result property="offlineNmpr" 			column="OFFLINE_NMPR"/>						<!-- 오프라인 접수인원	-->
			<result property="sttus00" 					column="STTUS00"/>								<!-- 집계 - 강좌 신청중  -->
			<result property="sttus01" 					column="STTUS01"/>								<!--집계 - 신청완료 - 수강접수  -->
			<result property="sttus02" 					column="STTUS02"/>								<!--집계 - 대기예약 - 수강접수  -->
			<result property="sttus03" 					column="STTUS03"/>								<!--집계 - 신청취소 요청  -->
			<result property="sttus04" 					column="STTUS04"/>								<!--집계 - 사용자-신청취소  -->
			<result property="sttus09" 					column="STTUS09"/>								<!--집계 - 신청취소 요청  -->
			<result property="sttus10" 					column="STTUS10"/>								<!--집계 - 사용자-신청취소  -->
</resultMap>

<resultMap id="edcAtnlcMngrUserMap" class="kr.co.hanshinit.NeoEdu.cop.edcAtnlcMngr.service.EdcAtnlcMngrVO">
			<result property="atnclKey" 						column="ATNCL_KEY"/>
			<result property="atnclNo" 						column="ATNCL_NO"/>
			<result property="lctreKey" 						column="LCTRE_KEY"/>
			<result property="useAt" 						column="USER_ID"/>
			<result property="diCode" 						column="DI_CODE"/>

			<result property="resveUserNm" 				column="RESVE_USER_NM"/>
			<result property="resveUserBrthdy" 			column="RESVE_USER_BRTHDY"/>
			<result property="userTel" 						column="USER_TEL"/>
			<result property="userEmail" 					column="USER_EMAIL"/>
			<result property="setleSttus"  					column="SETLE_STTUS"/>

			<result property="userNm" 						column="USER_NM"/>
			<result property="userBrthdy" 					column="USER_BRTHDY"/>
			<result property="userSexdstn" 				column="USER_SEXDSTN"/>
			<result property="edcNmpr" 					column="EDC_NMPR"/>
			<result property="sttus" 							column="STTUS"/>

			<result property="tel01" 							column="TEL01"/>
			<result property="drwtIdx" 						column="DRWT_IDX"/>
			<result property="drwtSttus" 					column="DRWT_STTUS"/>
			<result property="dscntPt" 						column="DSCNT_PT"/>
			<result property="ihidnum1" 					column="IHIDNUM1"/>

			<result property="ihidnum2" 					column="IHIDNUM2"/>
			<result property="indvdlzSetleAmount" 		column="INDVDLZ_SETLE_AMOUNT"/>
			<result property="frstRegisterPnttm" 			column="FRST_REGISTER_PNTTM"/>
			<result property="rceptMth" 					column="RCEPT_MTH"/>
			<result property="dscntCode" 					column="DSCNT_CODE"/>
			<result property="sn" 							column="SN"/>
			<result property="agncyRceptYn" 				column="AGNCY_RCEPT_YN"/>
			<result property="confmHmpgReflctAt" 		column="CONFM_HMPG_REFLCT_AT"/>
</resultMap>


<resultMap id="cmmnPaylogMap" class="kr.co.hanshinit.NeoCop.cop.cmmnPaylog.service.CmmnPaylogVO">
	<result property="paylogCd" column="PAYLOG_CD"/>									<!-- 고유번호 -->
	<result property="appCd" column="APP_CD"/>												<!-- 신청고유번호 (예약번호, 수강신청번호, 시설대관신청번호, 패기물 신청번호 등) -->
	<result property="jobSe" column="JOB_SE"/>													<!-- 업무구분 (EC:교육, FC:시설대관, SC:특별예약) -->
	<result property="siteId" column="SITE_ID"/>													<!-- 사이트 아이디 -->
	<result property="tid" column="TID"/>																<!-- 거래번호 -->
	<result property="resultcode" column="RESULTCODE"/>								<!-- 결과코드 -->
	<result property="resultmsg" column="RESULTMSG"/>									<!-- 결과내용 -->
	<result property="paymethod" column="PAYMETHOD"/>							<!-- 지불방법 -->
	<result property="moid" column="MOID"/>														<!-- 상점주문번호 -->
	<result property="totprice" column="TOTPRICE"/>											<!-- 결제완료금액 -->
	<result property="appidate" column="APPIDATE"/>										<!-- PG사 승인날짜 또는 수동 등록일자 -->
	<result property="appitime" column="APPITIME"/>											<!-- PG사 승인시각 또는 수동 등록시간 -->
	<result property="cardQuota" column="CARD_QUOTA"/>							<!-- 할부기간 -->
	<result property="cardInterest" column="CARD_INTEREST"/>						<!-- 무이자할부여부 -->
	<result property="cardBankNm" column="CARD_BANK_NM"/>					<!-- 카드명 또는 은행명 -->
	<result property="cardBankCode" column="CARD_BANK_CODE"/>			<!-- 카드 번호 또는 계좌번호 -->
	<result property="cardBankNum" column="CARD_BANK_NUM"/>			<!-- 신용카드번호 -->
	<result property="cardBankGubun" column="CARD_BANK_GUBUN"/>	<!-- B:은행, C:카드 -->
	<result property="autoSe" column="AUTO_SE"/>											<!-- 수동 등록 여부 (Y:수동등록, N:온라인 결제) -->
	<result property="rcpmnySe" column="RCPMNY_SE"/>									<!-- 1:입금, 2:환불 -->
	<result property="appNum" column="APP_NUM"/>										<!-- 승인번호 -->
	<result property="payId" column="PAY_ID"/>													<!-- 임금자 아이디, 수동입급자 아이디 -->
	<result property="payNm" column="PAY_NM"/>												<!-- 임금자 이름, 수동입금자 이름 -->
	<result property="payDesc" column="PAY_DESC"/>										<!-- PG결제상세 -->
	<result property="deleteAt" column="DELETE_AT"/>										<!-- 삭제유무 -->
	<result property="frstRegisterPnttm" column="FRST_REGISTER_PNTTM"/>	<!-- 최초등록일시 -->
	<result property="frstRegisterId" column="FRST_REGISTER_ID"/>				<!-- 최초등록자ID -->
	<result property="frstRegisterIp" column="FRST_REGISTER_IP"/>				<!-- 최초등록자IP -->
	<result property="lastUpdusrPnttm" column="LAST_UPDUSR_PNTTM"/>	<!-- 최종수정시점 -->
	<result property="lastUpdusrId" column="LAST_UPDUSR_ID"/>						<!-- 최종수정자ID -->
	<result property="lastUpdusrIp" column="LAST_UPDUSR_IP"/>						<!-- 최종수정자IP -->
	<result property="vaDate" column="VA_DATE"/>												<!-- 가상계좌 입금 마감일 -->
	<result property="mobileAt" column="MOBILE_AT"/>										<!-- 모바일 결제 유무 (Y:모바일, N:PC) -->
	<result property="userMobile" column="USER_MOBILE"/>
	<result property="lctreNm" column="LCTRE_NM"/>					
	<result property="userId" column="USER_ID"/>					
	<result property="userNm" column="USER_NM"/>					
	<result property="setleSttus" column="SETLE_STTUS"/>					
	<result property="userRceptSttus" column="USER_RCEPT_STTUS"/>	
	<result property="userUserNm" column="USER_USER_NM"/>		
	<result property="rcpmnyNm" column="RCPMNY_NM"/>		
	
	
</resultMap>

<!-- 조회 조건  -->
<sql id="searchAtnlc.condition">
	<dynamic prepend="WHERE" >
		<isNotEmpty prepend="AND" property="searchAtnclKey" >
					<!-- 수강신청 KEY -->
		   			T1.ATNCL_KEY = #searchAtnclKey#
		 </isNotEmpty>
		<isEqual prepend="AND" property="searchDateGubun"  compareValue="P">
			<isNotEmpty  prepend="AND" property="searchStartDate" >
				<!-- 우선접수 시작일 -->
				T2.PRIOR_RCEPT_BGNDE <![CDATA[ >= ]]>  #searchStartDate# AND  T2.PRIOR_RCEPT_BGNDE <![CDATA[ <= ]]>  #searchEndDate#
			</isNotEmpty>
		</isEqual>
		<isEqual prepend="AND" property="searchDateGubun"  compareValue="R">
			<isNotEmpty  prepend="AND" property="searchStartDate" >
				<!-- 접수시작일 -->
				T2.RCEPT_BGNDE <![CDATA[ >= ]]>  #searchStartDate# AND  T2.RCEPT_BGNDE <![CDATA[ <= ]]>  #searchEndDate#
			</isNotEmpty>
		</isEqual>
		<isEqual prepend="AND" property="searchDateGubun"  compareValue="E">
				<!-- 교육시작일 -->
				<isNotEmpty  property="searchStartDate" >
					T2.EDC_BGNDE <![CDATA[ >= ]]>  #searchStartDate# AND  T2.EDC_BGNDE <![CDATA[ <= ]]>  #searchEndDate#
				</isNotEmpty>
		</isEqual>
		<isNotEmpty prepend="AND" property="searchLctreKey" >
					<!-- 강좌 PK  -->
					T1.LCTRE_KEY = #searchLctreKey#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="searchInsttCode" >
					<!-- 기관 코드  -->
					T2.INSTT_CODE = #searchInsttCode#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="searchInsttNm" >
					<!-- 기관명  -->
					T2.INSTT_CODE IN (SELECT INSTT_CODE FROM TN_EDC_INSTT_MNGR WHERE INSTT_NM LIKE <![CDATA['%]]>$searchInsttNm$<![CDATA[%']]>)
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="authUserId" >
					<!-- 기관  조회 권한 설정 -->
		   			T2.INSTT_CODE IN (SELECT INSTT_CODE FROM TN_RESVE_INSTT_AUTHOR WHERE USER_ID = #authUserId# AND USE_AT = 'Y' AND DELETE_AT ='N')
		 </isNotEmpty>
	</dynamic>
</sql>

<sql id="searchAtnlcLctre.condition">
		<isEqual prepend="AND" property="searchDateGubun"  compareValue="P">
				<!-- 우선접수 시작일 -->
				<isNotEmpty   property="searchStartDate" >
				A.PRIOR_RCEPT_BGNDE <![CDATA[ >= ]]>  #searchStartDate# AND  A.PRIOR_RCEPT_BGNDE <![CDATA[ <= ]]>  #searchEndDate#
				</isNotEmpty>
		</isEqual>
		<isEqual prepend="AND" property="searchDateGubun"  compareValue="R">
				<!-- 접수시작일 -->
				<isNotEmpty  property="searchStartDate" >
				A.RCEPT_BGNDE <![CDATA[ >= ]]>  #searchStartDate# AND  A.RCEPT_BGNDE <![CDATA[ <= ]]>  #searchEndDate#
				</isNotEmpty>
		</isEqual>
		<isEqual prepend="AND" property="searchDateGubun"  compareValue="E">
				<!-- 교육시작일 -->
				<isNotEmpty  property="searchStartDate" >
					A.EDC_BGNDE <![CDATA[ >= ]]>  #searchStartDate# AND A.EDC_BGNDE <![CDATA[ <= ]]>  #searchEndDate#
				</isNotEmpty>
		</isEqual>
		<isNotEmpty prepend="AND" property="searchLctreKey" >
					<!-- 강좌 PK  -->
					A.LCTRE_KEY = #searchLctreKey#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="searchLctreKeyIn" >
					<!-- 강좌 PK  -->
					A.LCTRE_KEY IN  <![CDATA[(]]>$searchLctreKeyIn$<![CDATA[)]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="searchInsttCode" >
					<!-- 기관 코드  -->
					A.INSTT_CODE = #searchInsttCode#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="searchInsttNm" >
					<!-- 기관명  -->
					A.INSTT_CODE IN (SELECT INSTT_CODE FROM TN_EDC_INSTT_MNGR WHERE INSTT_NM LIKE <![CDATA['%]]>$searchInsttNm$<![CDATA[%']]>)
		</isNotEmpty>

		<isNotEmpty prepend="AND" property="searchLctreNm" >
					<!-- 강좌명  -->
					A.LCTRE_NM LIKE <![CDATA['%]]>$searchLctreNm$<![CDATA[%']]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="searchInstrctrNm" >
					<!-- 강사명  -->
					A.LCTRE_KEY IN (SELECT LCTRE_KEY FROM TN_EDC_LCTRE_INSTRCTR WHERE INSTRCTR_NM LIKE <![CDATA[ '%]]>$searchInstrctrNm$<![CDATA[%']]>)
		</isNotEmpty>

		<isNotEmpty prepend="AND" property="searchUserNm" >
					<!-- 수강자명  -->
					A.LCTRE_KEY IN (SELECT B.LCTRE_KEY FROM TN_EDC_ATNLC_USER A, TN_EDC_ATNLC_MNGR B WHERE A.ATNCL_KEY = B.ATNCL_KEY AND A.USER_NM LIKE <![CDATA[ '%]]>$searchUserNm$<![CDATA[%']]>)
		</isNotEmpty>

		<isNotEmpty prepend="AND" property="searchRceptSttus" >
					<!-- 강좌상태  -->
					A.RCEPT_STTUS = #searchRceptSttus#
					AND A.CANCEL_YN = 'N'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="searchLctreLclas">
					<!-- 강좌 대분류  -->
					A.LCTRE_LCLAS = #searchLctreLclas#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="searchRceptMth" >
					<!-- 모집방법  -->
					A.RCEPT_MTH = #searchRceptMth#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="searchPriorRceptMth" >
					<!-- 모집방법  -->
					(A.RCEPT_MTH = #searchPriorRceptMth# OR A.PRIOR_RCEPT_MTH = #searchPriorRceptMth#)
		</isNotEmpty>		
		<isNotEmpty prepend="AND" property="searchLecRegType" >
					<!-- 강좌접수 형태-접수일정, 상시접수  -->
					A.EDC_TARGET = #searchLecRegType#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="authUserId" >
					<!-- 기관  조회 권한 설정 -->
		   			A.INSTT_CODE IN (SELECT INSTT_CODE FROM TN_RESVE_INSTT_AUTHOR WHERE USER_ID = #authUserId# AND USE_AT = 'Y' AND DELETE_AT ='N')
		</isNotEmpty>

		<isNotEmpty prepend="AND" property="searchSemstrCode" >
					<!-- 기수(사업관리) 대분류  -->
					A.SEMSTR_CODE = #searchSemstrCode#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="searchSemstrCodeDetail" >
					<!-- 기수(사업관리) 소분류  -->
					A.SEMSTR_CODE_DETAIL = #searchSemstrCodeDetail#
		</isNotEmpty>

		<isNotEmpty prepend="AND" property="searchDstrct" >
					A.INSTT_CODE IN (SELECT INSTT_CODE FROM TN_EDC_INSTT_MNGR WHERE  DSTRCT_CL = #searchDstrct#)
		</isNotEmpty>

		<isNotEmpty prepend="AND" property="searchRcritMth" >
					<!-- 모집방법  (01:방문, 02:온라인, 04:전화)  -->
					A.RCRIT_MTH LIKE  <![CDATA[ '%]]>$searchRcritMth$<![CDATA[%']]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="searchEdcSttus" >
			<!-- 교육상태  -->
			A.EDC_STTUS = #searchEdcSttus#
		</isNotEmpty>
</sql>

<insert id="edcAtnlcMngrDAO.insertEdcAtnlcMngr" parameterClass="edcAtnlcMngrVO">
	<selectKey keyProperty="atnclKey" resultClass="Integer">
		SELECT AUTO_INCREMENT FROM information_schema.tables WHERE table_name = 'TN_EDC_ATNLC_MNGR' AND table_schema = DATABASE()
	</selectKey>
			INSERT INTO TN_EDC_ATNLC_MNGR (
				ATNCL_KEY,
				ATNCL_NO,
				LCTRE_KEY,
				USER_ID,
				DI_CODE,
				SORT_NO,
				USER_NM,
				USER_SEXDSTN,
				USER_BRTHDY,
				USER_TEL,
				USER_EMAIL,
				ZIP,
				ADRES,
				ADRES_DETAIL,
				USER_RCEPT_STTUS,
				SETLE_STTUS,
				RCEPT_YEAR,
				RCEPT_MT,
				RCEPT_DAY,
				RCEPT_TIME,
				RCEPT_DE,
				RCEPT_MTH,
				RCEPT_NMPR,
				AGNCY_RCEPT_YN,
				EDC_TIME,
				SETLE_AMOUNT,
				DSCNT_YN,
				CONFM_DE,
				CANCEL_DE,
				CONFM_HMPG_REFLCT_AT,
				FRST_REGISTER_PNTTM,
				FRST_REGISTER_ID,
				FRST_REGISTER_IP,
				LAST_UPDUSR_PNTTM,
				LAST_UPDUSR_ID,
				LAST_UPDUSR_IP,
				USER_MOBILE,
				ETC_CT,
				SMS_YN,
				MBER_SE,
				MEMO,
				RCPMNY_NM,
				METPAY,
				RECEIPT_METHOD,
				WAIT_AT
			)
			VALUES (
				#atnclKey#,
				CONCAT(#atnclNo#,(SELECT DATE_FORMAT(SYSDATE(), '%y%m%d%H%m%s') FROM DUAL)),
				#lctreKey#,
				#userId#,
				#diCode#,
				#sortNo#,
				#userNm#,
				#userSexdstn#,
				#userBrthdy#,
				#userTel#,
				#userEmail#,
				#zip#,
				#adres#,
				#adresDetail#,
				#userRceptSttus#,
				#setleSttus#,
				#rceptYear#,
				#rceptMt#,
				#rceptDay#,
				#rceptTime#,
				#rceptDe#,
				#rceptMth#,
				#rceptNmpr#,
				#agncyRceptYn#,
				#edcTime#,
				#setleAmount#,
				#dscntYn#,
				#confmDe#,
				#cancelDe#,
				#confmHmpgReflctAt#,
				#frstRegisterPnttm#,
				#frstRegisterId#,
				#frstRegisterIp#,
				#lastUpdusrPnttm#,
				#lastUpdusrId#,
				#lastUpdusrIp#,
				#userMobile#,
				#etcCt#,
				#smsYn#,
				#mberSe#,
				#memo#,
				#rcpmnyNm#,
				#metpay#,
				#receiptMethod#,
				#waitAt#
			)
</insert>

<update id="edcAtnlcMngrDAO.updateEdcAtnlcMngr" parameterClass="edcAtnlcMngrVO">
	UPDATE
				TN_EDC_ATNLC_MNGR SET
					<isNotEmpty  property="userId" >
						USER_ID = #userId#,
					</isNotEmpty>
					<isNotEmpty  property="userRceptSttus" >
						USER_RCEPT_STTUS = #userRceptSttus#,
					</isNotEmpty>
					<isNotEmpty  property="rceptMth" >
						RCEPT_MTH = #rceptMth#,
					</isNotEmpty>
					<isNotEmpty  property="confmDe" >
						CONFM_DE = #confmDe#,
					</isNotEmpty>
					<isNotEmpty  property="metpay" >
						METPAY = #metpay#,
					</isNotEmpty>
					<isNotEmpty  property="rcpmnyNm" >
						RCPMNY_NM = #rcpmnyNm#,
					</isNotEmpty>
						SORT_NO = #sortNo#,
						USER_NM = #userNm#,
						USER_SEXDSTN = #userSexdstn#,
						USER_BRTHDY = #userBrthdy#,
						USER_TEL = #userTel#,
						USER_EMAIL = #userEmail#,
						USER_MOBILE = #userMobile#,
						ZIP = #zip#,
						ADRES = #adres#,
						ADRES_DETAIL = #adresDetail#,
						SETLE_STTUS = #setleSttus#,
						AGNCY_RCEPT_YN = #agncyRceptYn#,
						SETLE_AMOUNT = #setleAmount#,
						ETC_CT = #etcCt#,
						DSCNT_YN = #dscntYn#,
						SMS_YN = #smsYn#,
						LAST_UPDUSR_PNTTM = #lastUpdusrPnttm#,
						LAST_UPDUSR_ID = #lastUpdusrId#,
						LAST_UPDUSR_IP = #lastUpdusrIp#,
						MEMO = #memo#
	WHERE ATNCL_KEY = #atnclKey#
</update>

<update id="edcAtnlcMngrDAO.updateEdcAtnlcMngrOptn" parameterClass="edcAtnlcMngrVO">
UPDATE TN_EDC_ATNLC_MNGR SET
	USER_RCEPT_STTUS = #userRceptSttus#,
	SETLE_STTUS = #setleSttus#,
	LAST_UPDUSR_PNTTM = #lastUpdusrPnttm#,
	LAST_UPDUSR_ID = #lastUpdusrId#,
	LAST_UPDUSR_IP = #lastUpdusrIp#
WHERE ATNCL_KEY = #atnclKey#
</update>


<update id="edcAtnlcMngrDAO.updateEdcAtnlcMngrSetleSttus" parameterClass="edcAtnlcMngrVO">
<!-- 결제 완료 처리  -->
UPDATE TN_EDC_ATNLC_MNGR SET
				SETLE_STTUS = #setleSttus#,
				<isNotEmpty  property="rcpmnyNm" >
				RCPMNY_NM = #rcpmnyNm#,
				</isNotEmpty>
				<isNotEmpty  property="metpay" >
				METPAY = #metpay#,
				</isNotEmpty>
				LAST_UPDUSR_PNTTM = #lastUpdusrPnttm#,
				LAST_UPDUSR_ID = #lastUpdusrId#,
				LAST_UPDUSR_IP = #lastUpdusrIp#
WHERE ATNCL_KEY = #atnclKey#
</update>

<update id="edcAtnlcMngrDAO.updateEdcAtnlcMngrSttus" parameterClass="edcAtnlcMngrVO">
	UPDATE
	            TN_EDC_ATNLC_MNGR
	      SET
	              USER_RCEPT_STTUS = #userRceptSttus#
	            <isNotEmpty  property="confmDe" >
	            , CONFM_DE = #confmDe#
	            </isNotEmpty>
	            <isNotEmpty  property="confmHmpgReflctAt" >
	            , CONFM_HMPG_REFLCT_AT = #confmHmpgReflctAt#
	           	</isNotEmpty>
	           	<isNotEmpty  property="setleSttus" >
	           	,SETLE_STTUS = #setleSttus#
	           	</isNotEmpty>
	            , LAST_UPDUSR_PNTTM = #lastUpdusrPnttm#
				, LAST_UPDUSR_ID = #lastUpdusrId#
				, LAST_UPDUSR_IP = #lastUpdusrIp#
	WHERE
				ATNCL_KEY = #atnclKey#
</update>

<!--  상태값 변경 처리 IN 조건 -->
<update id="edcAtnlcMngrDAO.updateEdcAtnlcMngrSttusIn" parameterClass="edcAtnlcMngrVO">
	UPDATE
	            TN_EDC_ATNLC_MNGR
	      SET
	              USER_RCEPT_STTUS 		= #userRceptSttus#
				, CONFM_DE					= #confmDe#
	            , LAST_UPDUSR_PNTTM 	= #lastUpdusrPnttm#
				, LAST_UPDUSR_ID 			= #lastUpdusrId#
				, LAST_UPDUSR_IP 			= #lastUpdusrIp#
	WHERE
				ATNCL_KEY IN ($atnclKeyStr$)
</update>


<!--  상태값 변경 처리 IN 조건 -->
<update id="edcAtnlcMngrDAO.updateEdcAtnlcMngrSemstrSttusIn" parameterClass="edcAtnlcMngrVO">
	UPDATE
	            TN_EDC_ATNLC_MNGR
	      SET
	              USER_RCEPT_STTUS = #userRceptSttus#
	            , LAST_UPDUSR_PNTTM = #lastUpdusrPnttm#
				, LAST_UPDUSR_ID = #lastUpdusrId#
				, LAST_UPDUSR_IP = #lastUpdusrIp#
	WHERE
				LCTRE_KEY IN (
					SELECT LCTRE_KEY FROM TN_EDC_LCTRE
					WHERE SEMSTR_CODE = #searchSemstrCode#
					<isNotEmpty  property="searchSemstrCodeDetail" >
						AND SEMSTR_CODE_DETAIL = #searchSemstrCodeDetail#
					</isNotEmpty>
				)
		AND USER_RCEPT_STTUS = #searchStatus#
</update>


<delete id="edcAtnlcMngrDAO.deleteEdcAtnlcMngr" parameterClass="edcAtnlcMngrVO">
<!-- DELETE FROM TN_EDC_ATNLC_MNGR WHERE ATNCL_KEY = #atnclKey# -->
	UPDATE TN_EDC_ATNLC_MNGR
	    SET CANCEL_DE = #cancelDe#
	WHERE ATNCL_KEY = #atnclKey#
</delete>

<select id="edcAtnlcMngrDAO.selectEdcAtnlcMngrList" resultMap="edcAtnlcMngrMap1" parameterClass="edcAtnlcMngrVO">
SELECT T1.*  FROM (
			SELECT @RNUM := @RNUM + 1 AS ROWNUM, T.* FROM (
						SELECT
							T1.ATNCL_KEY,
							T1.ATNCL_NO,
							T1.LCTRE_KEY,
							T1.USER_ID,
							T1.DI_CODE,
							T1.SORT_NO,
							T1.USER_NM,
							T1.USER_SEXDSTN,
							T1.USER_BRTHDY,
							T1.USER_TEL,
							T1.USER_EMAIL,
							T1.ZIP,
							T1.ADRES,
							T1.ADRES_DETAIL,
							T1.USER_RCEPT_STTUS,
							T1.SETLE_STTUS,
							T1.RCEPT_YEAR,
							T1.RCEPT_MT,
							T1.RCEPT_DAY,
							T1.RCEPT_TIME,
							T1.RCEPT_DE,
							T1.RCEPT_MTH,
							T1.RCEPT_NMPR,
							T1.AGNCY_RCEPT_YN,
							IFNULL(T1.EDC_TIME, 0) AS EDC_TIME,
							IFNULL(T1.SETLE_AMOUNT, 0) AS SETLE_AMOUNT,
							IFNULL(T1.ETC_CT, 0) AS ETC_CT,
							T1.DSCNT_YN,
							T1.CONFM_DE,
							T1.CANCEL_DE,
							T1.FRST_REGISTER_PNTTM,
							T1.FRST_REGISTER_ID,
							T1.FRST_REGISTER_IP,
							T1.LAST_UPDUSR_PNTTM,
							T1.LAST_UPDUSR_ID,
							T1.LAST_UPDUSR_IP,
							T1.CONFM_HMPG_REFLCT_AT,
							A.LCTRE_NM,
							A.EDC_BGNDE,
							A.EDC_ENDDE,
							T1.USER_MOBILE,
							A.EDC_STTUS,
							T1.SMS_YN,
							T1.RCPMNY_NM,
							T1.METPAY,
							T1.MEMO,
							T1.MBER_SE,
							A.ETC_CT_YN,
							A.INSTT_CODE,
							A.RCEPT_STTUS_AUTO_AT,
							A.CANCEL_YN,
							U.USER_NM AS ATNLC_USER_NM,
							U.TEL02	AS ATNLC_USER_TEL
							
						FROM TN_EDC_ATNLC_MNGR T1,  TN_EDC_LCTRE A, TN_EDC_ATNLC_USER U 
						WHERE T1.LCTRE_KEY = A.LCTRE_KEY
						AND  T1.ATNCL_KEY = U.ATNCL_KEY
						<include refid="searchAtnlcLctre.condition"/>
							<isNotEmpty property="searchKrwd" prepend=" AND ">
								(
									T1.USER_NM LIKE '%$searchKrwd$%' OR
									T1.USER_TEL LIKE '%$searchKrwd$%' OR
									T1.USER_ID LIKE '%$searchKrwd$%' OR
									T1.USER_MOBILE LIKE '%$searchKrwd$%' OR
									A.LCTRE_NM LIKE '%$searchKrwd$%'
								)
							</isNotEmpty>
							<isNotEmpty property="searchStatus" prepend=" AND ">
								T1.USER_RCEPT_STTUS = #searchStatus#
							</isNotEmpty>
							<isNotEmpty property="searchSetleSttus" prepend=" AND ">
								T1.SETLE_STTUS = #searchSetleSttus#
							</isNotEmpty>
							<isNotEmpty property="searchSexdstn" prepend=" AND ">
								T1.USER_SEXDSTN = #searchSexdstn#
							</isNotEmpty>
							<isNotEmpty prepend="AND" property="searchAll" >
									<!-- 강좌명, 신청자명, 연락처 통합  -->
<!-- 										A.LCTRE_NM LIKE <![CDATA['%]]>$searchAll$<![CDATA[%']]> -->
										 ( 
										 T1.USER_NM LIKE <![CDATA['%]]>$searchAll$<![CDATA[%']]>
										  OR U.USER_NM LIKE <![CDATA['%]]>$searchAll$<![CDATA[%']]> 
										  OR T1.USER_ID LIKE <![CDATA['%]]>$searchAll$<![CDATA[%']]> 
										  OR T1.USER_MOBILE LIKE <![CDATA['%]]>$searchAll$<![CDATA[%']]> 
										  OR U.TEL02 LIKE <![CDATA['%]]>$searchAll$<![CDATA[%']]> 
										  OR T1.RCPMNY_NM LIKE <![CDATA['%]]>$searchAll$<![CDATA[%']]> 
										  
										  )
<!-- 										OR  T1.USER_TEL LIKE <![CDATA['%]]>$searchAll$<![CDATA[%']]> -->
							</isNotEmpty>
					  
		) T, (SELECT @RNUM := 0) R
	) T1 ORDER BY T1.ATNCL_KEY DESC LIMIT #firstIndex#, #lastIndex#  
</select>

<select id="edcAtnlcMngrDAO.selectEdcAtnlcMngrData" resultMap="edcAtnlcMngrMap" parameterClass="edcAtnlcMngrVO">
			SELECT
				T1.ATNCL_KEY,
				T1.ATNCL_NO,
				T1.LCTRE_KEY,
				A.LCTRE_NM,
				T1.USER_ID,
				T1.DI_CODE,
				T1.SORT_NO,
				T1.USER_NM,
				T1.USER_SEXDSTN,
				T1.USER_BRTHDY,
				T1.USER_TEL,
				T1.USER_EMAIL,
				T1.ZIP,
				T1.ADRES,
				T1.ADRES_DETAIL,
				T1.USER_RCEPT_STTUS,
				T1.SETLE_STTUS,
				T1.RCEPT_YEAR,
				T1.RCEPT_MT,
				T1.RCEPT_DAY,
				T1.RCEPT_TIME,
				T1.RCEPT_DE,
				T1.RCEPT_MTH,
				T1.RCEPT_NMPR,
				T1.AGNCY_RCEPT_YN,
				IFNULL(T1.EDC_TIME, 0) AS EDC_TIME,
				IFNULL(T1.SETLE_AMOUNT, 0) AS SETLE_AMOUNT,
				IFNULL(T1.ETC_CT, 0) AS ETC_CT,
				T1.DSCNT_YN,
				T1.CONFM_DE,
				T1.CANCEL_DE,
				T1.FRST_REGISTER_PNTTM,
				T1.FRST_REGISTER_ID,
				T1.FRST_REGISTER_IP,
				T1.LAST_UPDUSR_PNTTM,
				T1.LAST_UPDUSR_ID,
				T1.LAST_UPDUSR_IP,
				T1.CONFM_HMPG_REFLCT_AT,
				A.EDC_BGNDE,
				A.EDC_ENDDE,
				T1.USER_MOBILE,
				A.EDC_STTUS,
				T1.SMS_YN,
				T1.RCPMNY_NM,
				T1.METPAY,
				T1.MEMO,
				T1.MBER_SE,
				A.ETC_CT_YN,
				A.INSTT_CODE,
				A.RCEPT_STTUS_AUTO_AT,
				A.CANCEL_YN
			FROM TN_EDC_ATNLC_MNGR T1 LEFT JOIN
			TN_EDC_LCTRE A ON T1.LCTRE_KEY = A.LCTRE_KEY
		<include refid="searchAtnlc.condition"/>
</select>

<select id="edcAtnlcMngrDAO.selectEdcAtnlcMngrTotCnt" resultClass="Integer" parameterClass="edcAtnlcMngrVO">
		SELECT
				  COUNT(*) AS TOT_CNT
		 FROM TN_EDC_ATNLC_MNGR T1, TN_EDC_LCTRE A, TN_EDC_ATNLC_USER U 
		WHERE T1.LCTRE_KEY = A.LCTRE_KEY
		AND  T1.ATNCL_KEY = U.ATNCL_KEY
		<include refid="searchAtnlcLctre.condition"/>
			<isNotEmpty property="searchKrwd" prepend=" AND ">
				(
					T1.USER_NM LIKE '%$searchKrwd$%' OR
					T1.USER_TEL LIKE '%$searchKrwd$%' OR
					T1.USER_ID LIKE '%$searchKrwd$%' OR
					T1.USER_MOBILE LIKE '%$searchKrwd$%' OR
					A.LCTRE_NM LIKE '%$searchKrwd$%'
				)
			</isNotEmpty>
			<isNotEmpty property="searchStatus" prepend=" AND ">
				T1.USER_RCEPT_STTUS = #searchStatus#
			</isNotEmpty>
			<isNotEmpty property="searchSetleSttus" prepend=" AND ">
				T1.SETLE_STTUS = #searchSetleSttus#
			</isNotEmpty>
			<isNotEmpty property="searchSexdstn" prepend=" AND ">
				T1.USER_SEXDSTN = #searchSexdstn#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="searchAll" >
					<!-- 강좌명, 신청자명, 연락처 통합  -->
<!-- 					A.LCTRE_NM LIKE <![CDATA['%]]>$searchAll$<![CDATA[%']]> -->
										 ( 
										 T1.USER_NM LIKE <![CDATA['%]]>$searchAll$<![CDATA[%']]>
										  OR U.USER_NM LIKE <![CDATA['%]]>$searchAll$<![CDATA[%']]> 
										  OR T1.USER_ID LIKE <![CDATA['%]]>$searchAll$<![CDATA[%']]> 
										  OR T1.USER_MOBILE LIKE <![CDATA['%]]>$searchAll$<![CDATA[%']]> 
										  OR U.TEL02 LIKE <![CDATA['%]]>$searchAll$<![CDATA[%']]> 
										  
										  )
<!-- 					OR  T1.USER_TEL LIKE <![CDATA['%]]>$searchAll$<![CDATA[%']]> -->
			</isNotEmpty>
</select>

<!-- 수강관리 > 접수관리 목록 조회  -->
<select id="edcAtnlcMngrDAO.selectEdcLctreAtnlcList" resultClass="edcAtnlcLctreVO" parameterClass="edcAtnlcLctreVO" remapResults="true">
						SELECT
						              A.LCTRE_KEY							AS lctreKey
						            , A.INSTT_CODE						AS insttCode
						            , A.LCTRE_LCLAS  						AS lctreLclas
						            , A.LCTRE_NM							AS lctreNm
						            , A.FREE_YN								AS freeYn
						            , IFNULL(A.ATNCL_CT, 0) 				AS atnclCt
						            , A.PRIOR_RCEPT_BGNDE 		AS priorRceptBgnde
						            , A.PRIOR_RCEPT_ENDDE 		AS priorRceptEndde
						            , A.RCEPT_BGNDE 					AS rceptBgnde
						            , A.RCEPT_ENDDE 					AS rceptEndde
						            , A.EDC_BGNDE	 					AS edcBgnde
						            , A.EDC_ENDDE	 					AS edcEndde
						            , A.ADIT_RCEPT_BGNDE			AS aditRceptBgnde
						            , A.ADIT_RCEPT_ENDDE			AS aditRceptEndde
						            , A.RCEPT_MTH	 					AS rceptMth
						            , A.PRIOR_RCEPT_MTH	 					AS priorRceptMth
						            , A.RCEPT_STTUS	 					AS rceptSttus
						            , A.EDC_STTUS		 					AS edcSttus
						            , A.USE_AT			 					AS useAt
						            , A.DRWT_DE							AS drwtDe
						            , A.CANCEL_YN						AS cancelYn
						            , IFNULL(A.PRIOR_RCEPT_WAIT_NMPR,0) 			AS priorRceptWaitNmpr
						            , IFNULL(A.PRIOR_RCEPT_NMPR,0) 			AS priorRceptNmpr
						            , IFNULL(A.RCRIT_NMPR,0) 			AS rcritNmpr
						            , IFNULL(A.ONLINE_NMPR, 0) 		AS onlineNmpr
						            , IFNULL(A.OFFLINE_NMPR, 0) 		AS offlineNmpr
						            , IFNULL(A.WAIT_NMPR, 0) 			AS waitNmpr
						            , IFNULL(B.STTUS00, 0) 				AS sttus00
						            , IFNULL(B.STTUS01, 0)	 			AS sttus01
						            , IFNULL(B.STTUS02, 0) 				AS sttus02
						            , IFNULL(B.STTUS03, 0) 				AS sttus03
						            , IFNULL(B.STTUS04, 0) 				AS sttus04
						            , IFNULL(B.STTUS09, 0) 				AS sttus09
						            , IFNULL(B.STTUS10, 0) 				AS sttus10
						            , IFNULL(B.STTUS01A, 0)	 			AS sttus01a
						            , IFNULL(B.STTUS02A, 0) 				AS sttus02a
						            , IFNULL(B.STTUS01B, 0)	 			AS sttus01b
						            , IFNULL(B.STTUS02B, 0) 				AS sttus02b						            						            
						            , IFNULL(B.WOMANCNT, 0) 		AS womanCnt
						            , IFNULL(B.MANCNT, 0) 				AS manCnt
						            , A.RCEPT_STTUS_AUTO_AT AS rceptSttusAutoAt
						            , A.EDC_DAY as edcDay
						            , A.EDC_TIME as edcTime
						            ,IFNULL(B.SETLE_STTUS01, 0) AS setleSttus01
						            ,IFNULL(B.SETLE_STTUS04, 0) AS setleSttus04
						   FROM (
						   
									SELECT
												           LCTRE_KEY		
												           ,INSTT_CODE		
												           ,LCTRE_LCLAS  	
												           ,LCTRE_NM		
												           ,FREE_YN		
												           ,ATNCL_CT 		
												           ,PRIOR_RCEPT_BGNDE 	
												           ,PRIOR_RCEPT_ENDDE 	
												           ,RCEPT_BGNDE 		
												           ,RCEPT_ENDDE 		
												           ,EDC_BGNDE	 	
												           ,EDC_ENDDE	 	
												           ,ADIT_RCEPT_BGNDE	
												           ,ADIT_RCEPT_ENDDE	
												           ,RCEPT_MTH	 	
												           ,PRIOR_RCEPT_MTH	 	
												           ,RCEPT_STTUS	 	
												           ,EDC_STTUS		
												           ,USE_AT		
												           ,DRWT_DE		
												           ,CANCEL_YN		
												           ,RCRIT_NMPR 	
												           ,PRIOR_RCEPT_NMPR
												           ,PRIOR_RCEPT_WAIT_NMPR	
												           ,ONLINE_NMPR 		
												           ,OFFLINE_NMPR 	
												           ,WAIT_NMPR 	
												           ,RCEPT_STTUS_AUTO_AT
												           ,EDC_DAY
												           ,EDC_TIME 																								   

											   FROM						   
						   						TN_EDC_LCTRE A
				        				          WHERE 1=1
												<isEqual prepend="AND" property="searchCnd" compareValue="INS">
							   						A.LCTRE_KEY IN (	SELECT B.LCTRE_KEY from	TN_EDC_LCTRE_INSTRCTR B WHERE B.USER_ID = #userId# )
						   						</isEqual>
				                  <include refid="searchAtnlcLctre.condition"/>							   						
											 ORDER BY edc_bgnde DESC, edc_endde DESC, lctre_key DESC
											  LIMIT #firstIndex#, #lastIndex#  
 										 ) A
									LEFT OUTER JOIN
						            (	 SELECT
	                                     aa1.LCTRE_KEY
                                       ,SUM(CASE WHEN BB.STTUS = '00' THEN BB.EDC_NMPR END) AS STTUS00
                                       ,SUM(CASE WHEN BB.STTUS = '01' THEN BB.EDC_NMPR END) AS STTUS01
                                       ,SUM(CASE WHEN BB.STTUS = '02' THEN BB.EDC_NMPR END) AS STTUS02
                                       ,SUM(CASE WHEN BB.STTUS = '03' THEN BB.EDC_NMPR END) AS STTUS03
                                       ,SUM(CASE WHEN BB.STTUS = '04' THEN BB.EDC_NMPR END) AS STTUS04
                                       ,SUM(CASE WHEN BB.STTUS = '09' THEN BB.EDC_NMPR END) AS STTUS09
                                       ,SUM(CASE WHEN BB.STTUS = '10' THEN BB.EDC_NMPR END) AS STTUS10
                                       ,SUM(CASE WHEN (BB.STTUS = '01' AND AA.RECEIPT_METHOD = 'A') THEN BB.EDC_NMPR END) AS STTUS01A
                                       ,SUM(CASE WHEN (BB.STTUS = '02' AND AA.RECEIPT_METHOD = 'A')THEN BB.EDC_NMPR END) AS STTUS02A
                                       ,SUM(CASE WHEN (BB.STTUS = '01' AND AA.RECEIPT_METHOD != 'A')THEN BB.EDC_NMPR END) AS STTUS01B
                                       ,SUM(CASE WHEN (BB.STTUS = '02' AND AA.RECEIPT_METHOD != 'A')THEN BB.EDC_NMPR END) AS STTUS02B                                                                   ,SUM(CASE WHEN AA.SETLE_STTUS = '01' THEN BB.EDC_NMPR END) AS SETLE_STTUS01
									   ,SUM(CASE WHEN AA.SETLE_STTUS = '04' THEN BB.EDC_NMPR END) AS SETLE_STTUS04                
                                       ,IFNULL(SUM(CASE
                                          WHEN BB.STTUS = '01' THEN
                                              CASE WHEN  BB.USER_SEXDSTN = 'F' THEN EDC_NMPR END
                                       END), 0) AS WOMANCNT
                                       ,IFNULL(SUM(CASE
                                          WHEN BB.STTUS = '01' THEN
                                              CASE WHEN  BB.USER_SEXDSTN = 'M' THEN EDC_NMPR END
                                       END), 0) AS MANCNT
                            FROM (SELECT lctre_key
												  FROM TN_EDC_LCTRE A
								                  WHERE 1=1 
								                 <include refid="searchAtnlcLctre.condition"/>										  
													 ORDER BY edc_bgnde DESC, edc_endde DESC, lctre_key DESC
												  LIMIT #firstIndex#, #lastIndex#  
												) aa1
									 INNER JOIN TN_EDC_ATNLC_MNGR AA
									    ON AA.lctre_key = aa1.lctre_key
									 INNER JOIN TN_EDC_ATNLC_USER BB
									    ON AA.atncl_key = BB.atncl_key
									 GROUP BY aa.lctre_key
									) B
								    ON A.lctre_key = B.lctre_key
				                  WHERE 1=1 
				                  <include refid="searchAtnlcLctre.condition"/>								    

</select>

<select id="edcAtnlcMngrDAO.selectEdcLctreAtnlcCnt" resultClass="Integer" parameterClass="edcAtnlcLctreVO">
		SELECT COUNT(*) AS TOT_CNT FROM TN_EDC_LCTRE A  WHERE 1=1
		<isEqual prepend="AND" property="searchCnd" compareValue="INS">
			A.LCTRE_KEY IN (	SELECT B.LCTRE_KEY from	TN_EDC_LCTRE_INSTRCTR B WHERE B.USER_ID = #userId# )
		</isEqual>		
		<include refid="searchAtnlcLctre.condition"/>
</select>


<select id="edcAtnlcMngrDAO.selectEdcAtnlcMngrUserList" resultMap="edcAtnlcMngrUserMap" parameterClass="edcAtnlcMngrVO">
		SELECT
		              A.ATNCL_KEY
		              , A.ATNCL_NO
		              , A.LCTRE_KEY
		              , A.USER_ID
		              , A.DI_CODE
		              , A.USER_NM	AS RESVE_USER_NM
		              , A.USER_BRTHDY AS RESVE_USER_BRTHDY
		              , A.USER_TEL
		              , A.USER_EMAIL
		              , A.SETLE_STTUS
		              , A.RCEPT_MTH
		              , B.USER_NM
		              , B.USER_BRTHDY
		              , B.USER_SEXDSTN
		              , B.EDC_NMPR
		              , B.STTUS
		              , B.TEL01
		              , B.DRWT_IDX
		              , B.DRWT_STTUS
		              , IFNULL(B.DSCNT_PT, 0) AS DSCNT_PT
		              , B.IHIDNUM1
		              , B.IHIDNUM2
		              , IFNULL(B.INDVDLZ_SETLE_AMOUNT, 0) AS INDVDLZ_SETLE_AMOUNT
		              , A.FRST_REGISTER_PNTTM
		              , B.DSCNT_CODE
		              , B.SN
		              , A.AGNCY_RCEPT_YN
		              , A.CONFM_HMPG_REFLCT_AT
		   FROM
		            	TN_EDC_ATNLC_MNGR A, TN_EDC_ATNLC_USER B
		  WHERE A.ATNCL_KEY = B.ATNCL_KEY
		  	  AND A.LCTRE_KEY = #searchLctreKey#
		     <isNotEmpty property="searchAtnclKeyIn">
		      AND A.ATNCL_KEY IN  <![CDATA[(]]>$searchAtnclKeyIn$<![CDATA[)]]>
		     </isNotEmpty>
		     <isNotEmpty property="searchUserNm">
		      AND (A.USER_NM LIKE <![CDATA['%]]>$searchUserNm$<![CDATA[%']]> OR B.USER_NM LIKE <![CDATA['%]]>$searchUserNm$<![CDATA[%']]>)
		     </isNotEmpty>
		   ORDER BY  A.ATNCL_KEY DESC, A.USER_RCEPT_STTUS
</select>

<select id="edcAtnlcMngrDAO.selectEdcAtnlcUserList" resultClass="edcAtnlcMngrVO" parameterClass="edcAtnlcMngrVO">
		SELECT
            		   A.ATNCL_KEY	AS atnclKey
                      , A.ATNCL_NO  AS atnclNo
                      , A.LCTRE_KEY  AS lctreKey
                      , A.USER_ID	AS userId
                      , A.DI_CODE	AS diCode
                      , A.USER_NM	AS resveUserNm
                      , A.USER_BRTHDY AS resveUserBrthdy
                      , A.USER_SEXDSTN AS userSexdstn
                      , A.USER_TEL AS userTel
                      , A.USER_EMAIL AS userEmail
                      , A.SETLE_STTUS AS setleSttus
                      , A.RCEPT_MTH	AS rceptMth
                      , A.USER_RCEPT_STTUS AS userRceptSttus
                      , A.AGNCY_RCEPT_YN AS agncyRceptYn
                      , A.CONFM_HMPG_REFLCT_AT AS confmHmpgReflctAt
                      , A.FRST_REGISTER_PNTTM AS frstRegisterPnttm
                      , B.CNT	AS cnt
                      , IFNULL(B.INDVDLZ_SETLE_AMOUNT,0) AS indvdlzSetleAmount
                      , IFNULL(B.ETC_AMOUNT,0) AS etcAmount
                      , A.USER_MOBILE AS userMobile
                      , B.WAIT_SN                AS waitSn
    	FROM
           TN_EDC_ATNLC_MNGR A ,
           (
           SELECT
                    ATNCL_KEY, IFNULL(SUM(EDC_NMPR),1) AS CNT , SUM(INDVDLZ_SETLE_AMOUNT) AS INDVDLZ_SETLE_AMOUNT
                    ,  SUM(ETC_AMOUNT) AS ETC_AMOUNT
                    ,  MAX(WAIT_SN) AS WAIT_SN
             FROM TN_EDC_ATNLC_USER
           WHERE LCTRE_KEY = #searchLctreKey#
           <isNotEmpty property="searchUserNm">
               AND USER_NM LIKE <![CDATA['%]]>$searchUserNm$<![CDATA[%']]>
           </isNotEmpty>
           <isNotEmpty property="searchRceptSttus">
               AND STTUS = #searchRceptSttus#
           </isNotEmpty>
           GROUP BY ATNCL_KEY
           ) B
WHERE A.ATNCL_KEY = B.ATNCL_KEY
    AND A.LCTRE_KEY = #searchLctreKey#
    <isNotEmpty property="searchUserNm">
    	AND A.USER_NM LIKE <![CDATA['%]]>$searchUserNm$<![CDATA[%']]>
    </isNotEmpty>
    <isNotEmpty property="searchAtnclKeyIn">
		      AND A.ATNCL_KEY IN  <![CDATA[(]]>#searchAtnclKeyIn#<![CDATA[)]]>
	</isNotEmpty>
	<isNotEmpty property="searchRceptSttus">
               AND A.USER_RCEPT_STTUS = #searchRceptSttus#
	</isNotEmpty>
	<isNotEmpty property="searchSetleSttus">
               AND A.SETLE_STTUS = #searchSetleSttus#
	</isNotEmpty>
	ORDER BY A.ATNCL_KEY DESC
</select>


<select id="edcAtnlcMngrDAO.selectEdcAtnlcUserList2" resultClass="edcAtnlcMngrVO" parameterClass="edcAtnlcMngrVO">
		SELECT
            		   A.ATNCL_KEY					AS atnclKey
                      , A.ATNCL_NO  				AS atnclNo
                      , A.LCTRE_KEY  				AS lctreKey
                      , A.USER_ID					AS userId
                      , A.DI_CODE					AS diCode
                      , A.USER_NM					AS resveUserNm
                      , A.USER_BRTHDY 			AS resveUserBrthdy
                      , A.USER_SEXDSTN 			AS userSexdstn
                      , A.USER_TEL 					AS userTel
                      , A.USER_EMAIL 				AS userEmail
                      , A.SETLE_STTUS 				AS setleSttus
                      , A.RCEPT_MTH				AS rceptMth
                      , A.USER_RCEPT_STTUS 		AS userRceptSttus
                      , A.AGNCY_RCEPT_YN 		AS agncyRceptYn
                      , A.CONFM_HMPG_REFLCT_AT AS confmHmpgReflctAt
                      , A.FRST_REGISTER_PNTTM AS frstRegisterPnttm
                      , IFNULL(B.INDVDLZ_SETLE_AMOUNT,0) AS indvdlzSetleAmount
                      , IFNULL(B.ETC_AMOUNT,0) 	AS etcAmount
                      , A.USER_MOBILE 			AS userMobile
                      , B.WAIT_SN                	AS waitSn
                      , B.USER_NM					AS atnlcUserNm
                      , B.TEL02						AS atnlcUserTel
                      , B.ZIP							AS atnlcUserZip
                      , B.ADRES						AS atnlcUserAddr
                      , B.ADRES_DETAIL				AS atnlcUserAddr2
                      , B.ATNLC_EMAIL				AS atnlcUserEmail
                      , B.USER_SEXDSTN			AS atnlcUserSexDstn
                      , B.USER_BRTHDY				AS atnlcUserBrthdy
					  , B.DSCNT_YN					AS dscntYn
					  , B.DSCNT_NM				AS dscntNm
					  , IFNULL(B.DSCNT_PT,0)			AS dscntPt
					  , B.EDC_NMPR					AS edcNmpr
					  , B.APPLCNT_RELATE			AS applcntRelate
					  , A.ZIP							AS zip
					  , A.ADRES						AS adres
					  , A.ADRES_DETAIL			AS adresDetail
					  , B.ZIP							AS atnlcUserZip
					  , B.ADRES						AS atnlcUserAddr
					  , B.ADRES_DETAIL				AS atnlcUserAddr2
					  , A.MEMO						AS memo
					  , B.DONG_CODE				AS dongCode
					  , A.CONFM_DE				AS confmDe
					  , A.WAIT_AT				AS waitAt
    	 FROM
           		  TN_EDC_ATNLC_MNGR A , TN_EDC_ATNLC_USER B
        WHERE A.ATNCL_KEY = B.ATNCL_KEY
    	  	AND A.LCTRE_KEY = #searchLctreKey#
    	<isNotEmpty property="searchUserNm">
    		AND A.USER_NM LIKE <![CDATA['%]]>$searchUserNm$<![CDATA[%']]>
    	</isNotEmpty>
    	<isNotEmpty property="searchAtnclKeyIn">
		    AND A.ATNCL_KEY IN  <![CDATA[(]]>#searchAtnclKeyIn#<![CDATA[)]]>
		</isNotEmpty>
		<isNotEmpty property="searchRceptSttus">
             AND A.USER_RCEPT_STTUS = #searchRceptSttus#
		</isNotEmpty>
		<isNotEmpty property="searchSetleSttus">
             AND A.SETLE_STTUS = #searchSetleSttus#
		</isNotEmpty>
		<isEqual property="searchSort" compareValue="DESC">
		ORDER BY A.ATNCL_KEY DESC
		</isEqual>
		<isEqual property="searchSort" compareValue="ASC">
		ORDER BY A.ATNCL_KEY ASC
		</isEqual>
</select>


<!-- 접수, 추첨시 제약 조건 및 모집인원 수 조회  -->
<select id="edcAtnlcMngrDAO.selectEdcLctreRstrctCnd"  parameterClass="edcLctreRstrctCndVO"  resultClass="edcLctreRstrctCndVO">
		SELECT
		              A.LCTRE_KEY						AS lctreKey
		            , AGNCY_RCEPT_YN            AS agncyRceptYn
		            , DPLCT_RCEPT_YN       		AS dplctRceptYn
		            , EDC_NMPR_LMTT            	AS lcedcNmprLmtttreKey
		            , GRP_YN   							AS grpYn
		            , GRP_RCEPT_NMPR       		AS grpRceptNmpr
		            , RCRIT_NMPR                  		AS rcritNmpr
		            , PRIOR_RCEPT_NMPR    		AS priorRceptNmpr
		            , WAIT_NMPR                   		AS waitNmpr
		            , ONLINE_NMPR               		AS onlineNmpr
		            , OFFLINE_NMPR              	AS offlineNmpr
		            , MALE_RCEPT_NMPR     	AS malRceptNmpr
		            , FEMALE_RCEPT_NMPR 	AS femaleRceptNmpr
		            , RCEPT_LMTT_MTH         	AS rceptLmttMth
		            , A.RCEPT_LMTT_SETUP  	AS rceptLmttSetup
		            , A.RCEPT_MTH					AS rceptMth
		            , B.SEMSTR_SAME_LMIT		AS semstrSameLmit
		            , B.SEMSTR_BEFORE_LMIT	AS semstrBeforeLmit
		            , B.DRWT_LMIT_YN				AS drwtLmitYn
		  FROM TN_EDC_LCTRE A, TN_EDC_INSTT_SEMSTR B
		 WHERE A.INSTT_CODE = B.INSTT_CODE(+)
		     AND A.SEMSTR_CODE = B.SEMSTR_CODE(+)
		     AND  A.LCTRE_KEY = #lctreKey#
</select>

<select id="edcAtnlcMngrDAO.selectCheckEdcAtnlcUserCnt" resultClass="Integer" parameterClass="edcAtnlcMngrVO">
		SELECT
		            	COUNT(*)
		    FROM TN_EDC_ATNLC_MNGR A, TN_EDC_ATNLC_USER B
		  WHERE A.LCTRE_KEY = B.LCTRE_KEY
		       AND A.ATNCL_KEY = B.ATNCL_KEY
       			<isNotEmpty prepend="AND" property="searchLctreKey" >
							A.LCTRE_KEY = #searchLctreKey#
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="searchAtnclKey" >
							A.ATNCL_KEY = #searchAtnclKey#
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="searchUserId" >
							A.USER_ID = #searchUserId#
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="searchStatus" >
							A.USER_RCEPT_STTUS IN  ($searchStatus$)
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="searchStartDate" >
							A.LCTRE_KEY IN
							(
								 SELECT LCTRE_KEY FROM TN_EDC_LCTRE
								 WHERE EDC_BGNDE <![CDATA[ >=]]> #searchStartDate# AND EDC_ENDDE <![CDATA[ <=]]> #searchEndDate#
								      AND EDC_BEGIN_TIME <![CDATA[ >=]]> #searchStartTime# AND EDC_END_TIME <![CDATA[ <=]]> #searchEndTime#
							)
				</isNotEmpty>
</select>


<select id="edcAtnlcMngrDAO.selectCheckEdcAtnlcUserEdcNmprCnt" resultClass="Integer" parameterClass="edcAtnlcMngrVO">
		SELECT
		            	IFNULL(SUM(EDC_NMPR),0) AS CNT
		    FROM TN_EDC_ATNLC_MNGR A, TN_EDC_ATNLC_USER B
		  WHERE A.LCTRE_KEY = B.LCTRE_KEY
		       AND A.ATNCL_KEY = B.ATNCL_KEY
       			<isNotEmpty prepend="AND" property="searchLctreKey" >
							A.LCTRE_KEY = #searchLctreKey#
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="searchAtnclKey" >
							A.ATNCL_KEY = #searchAtnclKey#
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="searchUserId" >
							A.USER_ID = #searchUserId#
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="searchStatus" >
							A.USER_RCEPT_STTUS IN  ($searchStatus$)
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="searchStartDate" >
							A.LCTRE_KEY IN
							(
								 SELECT LCTRE_KEY FROM TN_EDC_LCTRE
								 WHERE EDC_BGNDE <![CDATA[ >=]]> #searchStartDate# AND EDC_ENDDE <![CDATA[ <=]]> #searchEndDate#
								      AND EDC_BEGIN_TIME <![CDATA[ >=]]> #searchStartTime# AND EDC_END_TIME <![CDATA[ <=]]> #searchEndTime#
							)
				</isNotEmpty>
</select>

<select id="edcAtnlcMngrDAO.selectReservationFinish" resultClass="edcAtnlcMngrVO" parameterClass="edcAtnlcMngrVO">
		SELECT
				        A.LCTRE_KEY						AS lctreKey
				        , A.LCTRE_NM						AS lctreNm
				        , B.USER_NM							AS userNm
				        , B.USER_ID							AS userId
				        , A.FREE_YN							AS freeYn
				        , B.USER_RCEPT_STTUS 		AS userRceptSttus
				        , B.ATNCL_KEY						AS atnclKey
		        FROM TN_EDC_LCTRE A, TN_EDC_ATNLC_MNGR B
		WHERE A.LCTRE_KEY = B.LCTRE_KEY
		    AND B.ATNCL_KEY = #searchAtnclKey#
</select>


<select id="edcAtnlcMngrDAO.myReqstLctreListCnt" resultClass="Integer" parameterClass="edcAtnlcMngrVO">
		SELECT
					COUNT(A.ATNCL_KEY) AS CNT
		  FROM TN_EDC_ATNLC_MNGR A, TN_EDC_LCTRE B
		WHERE A.USER_ID =#searchUserId#
			 AND A.LCTRE_KEY = B.LCTRE_KEY
</select>


<select id="edcAtnlcMngrDAO.myReqstLctreList" resultClass="edcAtnlcMngrVO" parameterClass="edcAtnlcMngrVO">
		SELECT T1.*  FROM (
					SELECT @RNUM := @RNUM + 1 AS ROWNUM, T.* FROM (
									  SELECT
										            A.ATNCL_KEY									AS atnclKey
										            , A.ATNCL_NO									AS atnclNo
										            , A.LCTRE_KEY									AS lctreKey
										            , A.USER_NM									AS userNM
										            , B.LCTRE_NM									AS lctreNm
										            , B.FREE_YN										AS freeYn
										            , IFNULL(A.SETLE_AMOUNT, 0) 			AS setleAmount
										            , A.SETLE_STTUS								AS setleSttus
										            , A.USER_RCEPT_STTUS   				AS userRceptSttus
										            , B.EDC_BGNDE								AS edcBgnde
										            , B.EDC_ENDDE								AS edcEndde
										            , B.EDC_BEGIN_TIME						AS edcBeginTime
										            , B.EDC_END_TIME							AS edcEndTime
										            , A.RCEPT_DE 									AS rceptDe
										            , B.EDC_STTUS									AS edcSttus
										            , B.RCEPT_STTUS								AS rceptSttus
										            , B.CANCEL_YN									AS cancelYn
										            , A.CONFM_HMPG_REFLCT_AT 	AS confmHmpgReflctAt
										            , B.RCEPT_MTH									AS rceptMth
										            , A.RCEPT_TIME									AS rceptTime
										            , B.FRST_REGISTER_PNTTM,
													B.EDC_TIME as edcTime,
													B.EDC_DAY as edcDay		
										 FROM TN_EDC_ATNLC_MNGR A, TN_EDC_LCTRE B
										WHERE A.USER_ID =#searchUserId#
										    AND A.LCTRE_KEY = B.LCTRE_KEY
							      
		) T, (SELECT @RNUM := 0) R
	) T1 ORDER BY T1.rceptDe DESC LIMIT #firstIndex#, #lastIndex#  
</select>

<select id="edcAtnlcMngrDAO.myPageLctreAtnlcView" resultClass="edcAtnlcMngrVO" parameterClass="edcAtnlcMngrVO">
		SELECT
			              A.ATNCL_KEY								AS atnclKey
			            , A.ATNCL_NO								AS atnclNo
			            , A.LCTRE_KEY								AS lctreKey
			            , A.USER_ID										AS userId
			            , A.DI_CODE									AS diCode
			            , A.USER_NM									AS userNm
			            , A.USER_SEXDSTN						AS userSexdstn
			            , A.USER_BRTHDY							AS userBrthdy
			            , A.USER_TEL									AS userTel
			            , A.USER_EMAIL								AS userEmail
			            , A.ZIP												AS zip
			            , A.ADRES											AS adres
			            , A.ADRES_DETAIL							AS adresDetail
			            , A.USER_RCEPT_STTUS				AS userRceptSttus
			            , A.SETLE_STTUS								AS setleSttus
			            , A.RCEPT_DE          						AS rceptDe
			            , IFNULL(A.RCEPT_NMPR,0)				AS rceptNmpr
			            , A.AGNCY_RCEPT_YN					AS agncyRceptYn
			            , IFNULL(A.EDC_TIME,0)					AS edcTime
			            , IFNULL(A.SETLE_AMOUNT,0)		AS setleAmount
			            , A.DSCNT_YN									AS dscntYn
			            , A.CONFM_DE								AS confmDe
			            , A.CANCEL_DE								AS cancelDe
			            , A.CONFM_HMPG_REFLCT_AT AS confmHmpgReflctAt
			            , A.USER_MOBILE							AS userMobile
			            , B.ETC_CT_YN								AS etcCtYn
			            , IFNULL(A.ETC_CT, 0)						AS etcCt
			            , IFNULL(B.ATNCL_CT,0)					AS atnclCt
			            , B.EDC_BGNDE								AS edcBgnde
			            , B.EDC_ENDDE								AS edcEndde
			            , B.EDC_BEGIN_TIME					AS edcBeginTime
			            , B.EDC_END_TIME						AS edcEndTime
			            , B.LCTRE_NM									AS lctreNm
			            , B.FREE_YN										AS freeYn
			            , B.EDC_DAY									AS edcDay
			            , B.SETLE_PD									AS setlePd
			            , B.EDC_STTUS								AS edcSttus
						, B.RCEPT_STTUS							AS rceptSttus
						, B.CANCEL_YN								AS cancelYn
						, B.SCHOOL_GRADE_YN				AS schoolGradeYn
						, B.INSTT_CODE								AS insttCode
						, (SELECT C.INDVDLZ_SETLE_AMOUNT FROM tn_edc_atnlc_user C WHERE C.ATNCL_KEY = #searchAtnclKey#)  AS indvdlzSetleAmount
		    FROM
		    				TN_EDC_ATNLC_MNGR A, TN_EDC_LCTRE B
		  WHERE A.LCTRE_KEY = B.LCTRE_KEY
		  <isNotEmpty property="searchUserId" >
		       AND A.USER_ID = #searchUserId#
		  </isNotEmpty>
		       AND A.ATNCL_KEY = #searchAtnclKey#
</select>

<update id="edcAtnlcMngrDAO.updateEdcAtnlcMngrInfo" parameterClass="edcAtnlcMngrVO">
			UPDATE
			              TN_EDC_ATNLC_MNGR
			       SET
			              USER_SEXDSTN				= #userSexdstn#
			            , USER_BRTHDY					= #userBrthdy#
			            , USER_TEL							= #userTel#
			            , USER_MOBILE					= #userMobile#
			            , USER_EMAIL						= #userEmail#
			            , ZIP											= #zip#
			            , ADRES									= #adres#
			            , ADRES_DETAIL					= #adresDetail#
<!-- 			            , SETLE_AMOUNT				= #setleAmount# -->
<!-- 			            , ETC_CT								= #etcCt# -->
<!-- 			            , DSCNT_YN							= #dscntYn# -->
			            , RCEPT_NMPR					= #rceptNmpr#
			            , LAST_UPDUSR_PNTTM	= #lastUpdusrPnttm#
			            , LAST_UPDUSR_ID			= #lastUpdusrId#
			            , LAST_UPDUSR_IP				= #lastUpdusrIp#
			 WHERE
			            ATNCL_KEY  						= #atnclKey#
</update>

<update id="edcAtnlcMngrDAO.updateAtnlcMngConfmHmpgReflctAt" parameterClass="edcAtnlcMngrVO">
	UPDATE
	            TN_EDC_ATNLC_MNGR
	      SET
	              CONFM_HMPG_REFLCT_AT = #confmHmpgReflctAt#
	            , LAST_UPDUSR_PNTTM = #lastUpdusrPnttm#
				, LAST_UPDUSR_ID = #lastUpdusrId#
				, LAST_UPDUSR_IP = #lastUpdusrIp#
	WHERE
				LCTRE_KEY = #lctreKey#
</update>

<select id="edcAtnlcMngrDAO.lctreAtnlcCount" resultClass="edcAtnlcMngrVO" parameterClass="edcAtnlcMngrVO">
		     SELECT
                                        LCTRE_KEY
                                        , IFNULL(SUM(STTUS00), 0) 							AS sttus00
                                        , IFNULL(SUM(STTUS01), 0) 							AS sttus01
                                        , IFNULL(SUM(STTUS02), 0) 							AS sttus02
                                        , IFNULL(SUM(STTUS03), 0) 							AS sttus03
                                        , IFNULL(SUM(STTUS04), 0) 							AS sttus04
                                        , IFNULL(SUM(STTUS09), 0) 							AS sttus09
                                        , IFNULL(SUM(STTUS10), 0) 							AS sttus10
                                        , IFNULL(SUM(SEXDST_SUM_F), 0)     		AS sexdstSumF
                                        , IFNULL(SUM(SEXDST_SUM_M), 0)     		AS sexdstSumM
                                        , IFNULL(SUM(SEXDST_SUM_C), 0)     		AS sexdstSumC
                                        , IFNULL(SUM(RCEPT_MTH_SUM_01), 0)  AS rceptMthSum01
                                        , IFNULL(SUM(RCEPT_MTH_SUM_02), 0)  AS rceptMthSum02
                                        , IFNULL(SUM(RCEPT_MTH_SUM_03), 0)  AS rceptMthSum03
                                        , IFNULL(SUM(RCEPT_MTH_SUM_04), 0)  AS rceptMthSum04
                                        , IFNULL(SUM(RCEPT_MTH_SUM_05), 0)	AS rceptMthSum05
                                        , IFNULL(SUM(WOMANCNT), 0) 					AS womanCnt
                                        , IFNULL(SUM(MANCNT), 0) 						AS manCnt
                 FROM
                              (
                                          SELECT
                                                        A.LCTRE_KEY
                                                        ,CASE WHEN B.STTUS = '00' THEN EDC_NMPR END AS STTUS00
                                                        ,CASE WHEN B.STTUS = '01' THEN EDC_NMPR END AS STTUS01
                                                        ,CASE WHEN B.STTUS = '02' THEN EDC_NMPR END AS STTUS02
                                                        ,CASE WHEN B.STTUS = '03' THEN EDC_NMPR END AS STTUS03
                                                        ,CASE WHEN B.STTUS = '04' THEN EDC_NMPR END AS STTUS04
                                                        ,CASE WHEN B.STTUS = '09' THEN EDC_NMPR END AS STTUS09
                                                        ,CASE WHEN B.STTUS = '10' THEN EDC_NMPR END AS STTUS10
                                                        ,CASE WHEN B.USER_SEXDSTN = 'F' THEN EDC_NMPR END AS SEXDST_SUM_F
                                                        ,CASE WHEN B.USER_SEXDSTN = 'M' THEN EDC_NMPR END AS SEXDST_SUM_M
                                                        ,CASE WHEN B.USER_SEXDSTN IS NULL THEN EDC_NMPR END AS SEXDST_SUM_C
                                                        ,CASE WHEN A.RCEPT_MTH = '01' THEN EDC_NMPR END AS RCEPT_MTH_SUM_01
                                                        ,CASE WHEN A.RCEPT_MTH = '02' THEN EDC_NMPR END AS RCEPT_MTH_SUM_02
                                                        ,CASE WHEN A.RCEPT_MTH = '03' THEN EDC_NMPR END AS RCEPT_MTH_SUM_03
                                                        ,CASE WHEN A.RCEPT_MTH = '04' THEN EDC_NMPR END AS RCEPT_MTH_SUM_04
                                                        ,CASE WHEN A.RCEPT_MTH = '05' THEN EDC_NMPR END AS RCEPT_MTH_SUM_05
                                                         ,CASE
                                                            WHEN B.STTUS = '01' THEN
                                                                CASE WHEN  B.USER_SEXDSTN = 'F' THEN EDC_NMPR END
                                                         END AS WOMANCNT
                                                         ,CASE
                                                            WHEN B.STTUS = '01' THEN
                                                                CASE WHEN  B.USER_SEXDSTN = 'M' THEN EDC_NMPR END
                                                         END AS MANCNT
                                           FROM
                                                        TN_EDC_ATNLC_MNGR A, TN_EDC_ATNLC_USER B
                                          WHERE A.LCTRE_KEY = #searchLctreKey#
                                               <!-- AND A.USER_RCEPT_STTUS IN ('00','01','02','09','10')   -->
                                               AND A.LCTRE_KEY = B.LCTRE_KEY
                                               AND A.ATNCL_KEY = B.ATNCL_KEY
		)
		GROUP BY LCTRE_KEY
</select>

<select id="edcAtnlcMngrDAO.semstrCodeCount" resultClass="edcAtnlcMngrVO" parameterClass="edcAtnlcMngrVO">
		SELECT
		              B.SEMSTR_CODE AS semstrCode
		            , COUNT(A.USER_ID) AS semstrUserCnt
		  FROM TN_EDC_ATNLC_MNGR A,
		  			  (
		  			  	SELECT
		  			  					LCTRE_KEY, SEMSTR_CODE
		  			  	  FROM TN_EDC_LCTRE
		  			  	WHERE SEMSTR_CODE IN ($searchSemstrCode$)
		  			  	     AND INSTT_CODE = #searchInsttCode#
		  			  	     AND CANCEL_YN = 'N'
		  			  ) B
		WHERE A.LCTRE_KEY = B.LCTRE_KEY
		     AND USER_ID =  #searchUserId#
		     AND A.USER_RCEPT_STTUS = #searchUserRceptSttus#
	    GROUP BY B.SEMSTR_CODE
 </select>

<select id="edcAtnlcMngrDAO.checkNmpr" resultClass="edcAtnlcMngrVO" parameterClass="Integer">
<!-- 정원 체크 -->
SELECT
          IFNULL(T1.RCRIT_NMPR, 0)               	AS rcritNmpr
        , IFNULL(T1.PRIOR_RCEPT_NMPR, 0) AS priorRceptNmpr
        , IFNULL(T1.WAIT_NMPR, 0)              	AS waitNmpr
        , IFNULL(T1.ONLINE_NMPR, 0)            AS onlineNmpr
        , IFNULL(T1.OFFLINE_NMPR, 0)          	AS offlineNmpr
        , IFNULL(T2.CNT, 0) 								AS cnt
        , T1.RCEPT_STTUS								AS rceptSttus
        , T1.PRIOR_RCEPT_BGNDE				AS priorRceptBgnde
        , T1.PRIOR_RCEPT_ENDDE				AS priorRceptEndde
        , T1.RCEPT_BGNDE							AS rceptBgnde
        , T1.RCEPT_ENDDE							AS rceptEndde
        , T1.ADIT_RCEPT_BGNDE				AS aditRceptBgnde
        , T1.ADIT_RCEPT_ENDDE				AS aditRceptEndde
   FROM
            TN_EDC_LCTRE T1,
            (
            SELECT LCTRE_KEY, COUNT(LCTRE_KEY) AS CNT FROM TN_EDC_ATNLC_MNGR
            WHERE LCTRE_KEY = #searchLctreKey#
                AND USER_RCEPT_STTUS IN ('00','01','02')
           GROUP BY LCTRE_KEY
             ) T2
WHERE T1.LCTRE_KEY = T2.LCTRE_KEY
    AND T1.LCTRE_KEY = #searchLctreKey#
</select>

<select id="edcAtnlcMngrDAO.edcAtnlcAddUserCheck"  resultClass="edcAtnlcMngrVO" parameterClass="edcAtnlcMngrVO" >
			SELECT
					  JOB_SE AS jobSe
	  				, IFNULL(COUNT(JOB_SE),0) AS cnt
	  				, A.USER_RCEPT_STTUS AS userRceptSttus
  			 FROM
      					TN_EDC_ATNLC_MNGR A,  TN_EDC_LCTRE_CNTC B
 			WHERE A.LCTRE_KEY = B.CNTC_LCTRE_KEY
   			   AND B.LCTRE_KEY = #searchLctreKey#
   			   <isNotEmpty prepend="AND" property="searchUserNm" >
		     		A.USER_NM = #searchUserNm#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="searchUserBrthdy" >
		     		A.USER_BRTHDY = #searchUserBrthdy#
	 		   </isNotEmpty>
   			   AND B.DELETE_AT = 'N'
   			   AND B.JOB_SE IN ('D', 'S', 'R')
   			   AND A.USER_RCEPT_STTUS IN ('01', '02')
   			   AND A.USER_ID = #searchUserId#
 			GROUP BY B.JOB_SE, A.USER_RCEPT_STTUS
</select>

<select id="edcAtnlcMngrDAO.edcAtnlcWaitList"  resultClass="edcAtnlcMngrVO" parameterClass="edcAtnlcMngrVO" >
		<!-- 수강 신청자 대기 순번 조회 -->
		SELECT
		            B.WAIT_SN	AS waitSn
		            , B.ATNCL_KEY AS atnclKey
		            , IFNULL(SUM(B.EDC_NMPR),1) AS cnt
		  FROM
		          TN_EDC_ATNLC_MNGR A,  TN_EDC_ATNLC_USER B
		WHERE A.LCTRE_KEY = B.LCTRE_KEY
		    AND A.ATNCL_KEY = B.ATNCL_KEY
		    <isNotEmpty property="searchAtnclKey">
		    AND A.ATNCL_KEY <![CDATA[ !=]]> #searchAtnclKey#
		    </isNotEmpty>
		    AND A.USER_RCEPT_STTUS = #searchUserRceptSttus#
		    AND A.LCTRE_KEY = #searchLctreKey#
		    <isEqual prepend="AND" property="receiptMethod" compareValue="A">
		    A.RECEIPT_METHOD = 'A'
		    </isEqual>
		    <isEqual prepend="AND" property="receiptMethod" compareValue="BC">
		    A.RECEIPT_METHOD != 'A'
		    </isEqual>		    
		 GROUP BY B.WAIT_SN, B.ATNCL_KEY
		 ORDER BY B.WAIT_SN, B.ATNCL_KEY
</select>

 <update id="edcAtnlcMngrDAO.updateEdcPayResult" parameterClass="edcAtnlcMngrVO">
 	<!-- 결제 방법 업데이트  -->
	UPDATE
				TN_EDC_ATNLC_MNGR
				SET
						RCPMNY_NM = #rcpmnyNm#
						,METPAY = #metpay#
						,LAST_UPDUSR_PNTTM = #lastUpdusrPnttm#
						,LAST_UPDUSR_ID = #lastUpdusrId#
						,LAST_UPDUSR_IP = #lastUpdusrIp#
	WHERE ATNCL_KEY = #atnclKey#
 </update>


 <select id="edcAtnlcMngrDAO.selectEdcAtnlcReserveList" resultClass="edcAtnlcMngr" parameterClass="edcAtnlcMngrVO">
		SELECT T1.*  FROM (
					SELECT @RNUM := @RNUM + 1 AS ROWNUM, T.* FROM (
								SELECT
										A.ATNCL_KEY		AS atnclKey
										, A.USER_NM		AS userNm
										, A.USER_BRTHDY	AS userBrthdy
										, A.USER_SEXDSTN	AS userSexdstn
										, A.TEL02				AS userMobile
        								, C.LCTRE_NM		AS lctreNm
        								, C.EDC_BGNDE		AS edcBgnde
        								, C.EDC_ENDDE		AS edcEndde
        								, B.ZIP					AS ZIP
        								, B.ADRES			AS adres
        								, B.ADRES_DETAIL	AS adresDetail
								FROM  TN_EDC_ATNLC_USER A, TN_EDC_ATNLC_MNGR B, TN_EDC_LCTRE C
								WHERE A.ATNCL_KEY = B.ATNCL_KEY
  								   AND A.LCTRE_KEY = C.LCTRE_KEY
								<isEqual prepend="AND" property="searchCnd"  compareValue="userNm">
									A.USER_NM LIKE <![CDATA['%]]>$searchKrwd$<![CDATA[%']]>
								</isEqual>
								<isEqual prepend="AND" property="searchCnd"  compareValue="userMobile">
									A.TEL02 LIKE <![CDATA['%]]>$searchKrwd$<![CDATA[%']]>
								</isEqual>
								<isNotEmpty prepend="AND" property="authUserId" >
									C.INSTT_CODE IN (SELECT INSTT_CODE FROM TN_RESVE_INSTT_AUTHOR WHERE USER_ID = #authUserId# AND USE_AT = 'Y' AND DELETE_AT ='N')
								</isNotEmpty>
							  
		) T, (SELECT @RNUM := 0) R
	) T1 ORDER BY userNm, edcBgnde DESC LIMIT #firstIndex#, #lastIndex#  
</select>

<select id="edcAtnlcMngrDAO.selectEdcAtnlcReserveListCnt" resultClass="Integer" parameterClass="edcAtnlcMngrVO">
 SELECT
		 IFNULL(COUNT(*), 0) AS CNT
  FROM
 	 	 TN_EDC_ATNLC_USER A, TN_EDC_ATNLC_MNGR B, TN_EDC_LCTRE C
 WHERE A.ATNCL_KEY = B.ATNCL_KEY
    AND A.LCTRE_KEY = C.LCTRE_KEY
    <isEqual prepend="AND" property="searchCnd"  compareValue="userNm">
		A.USER_NM LIKE <![CDATA['%]]>$searchKrwd$<![CDATA[%']]>
	</isEqual>
	<isEqual prepend="AND" property="searchCnd"  compareValue="userMobile">
		A.TEL02 LIKE <![CDATA['%]]>$searchKrwd$<![CDATA[%']]>
	</isEqual>
</select>

<select id="edcAtnlcMngrDAO.selectEdcCnt" resultClass="Integer" parameterClass="edcAtnlcMngrVO">
		SELECT
		         IFNULL(SUM(EDC_NMPR), 0) AS CNT
 	     FROM
		        TN_EDC_ATNLC_USER A, TN_EDC_ATNLC_MNGR B
		WHERE
		      A.LCTRE_KEY = B.LCTRE_KEY
		  AND A.ATNCL_KEY = B.ATNCL_KEY
		  AND A.LCTRE_KEY = #searchLctreKey#
		  AND B.USER_ID = #searchUserId#
		  AND B.USER_RCEPT_STTUS IN ('00', '01', '02')
</select>

<select id="edcAtnlcMngrDAO.selectEdcRcritNmprSttus" resultClass="edcAtnlcMngrVO" parameterClass="edcAtnlcMngrVO">
		<!-- 강좌 정원 및 수강생 상태에 따른 인원 조회  -->
		SELECT
     		  RCRIT_NMPR AS rcritNmpr
      		, RCEPT_MTH AS rceptMth
      		, (SELECT IFNULL(SUM(EDC_NMPR), 0) FROM TN_EDC_ATNLC_USER WHERE LCTRE_KEY = #searchLctreKey# AND STTUS=#searchStatus#) AS cnt
  		FROM
       			TN_EDC_LCTRE
 	  WHERE LCTRE_KEY = #searchLctreKey#
</select>


<select id="edcAtnlcMngrDAO.selectEdcAtnlcPayMngrList" resultMap="cmmnPaylogMap" parameterClass="cmmnPaylogVO">
SELECT T1.*  FROM (
            SELECT @RNUM := @RNUM + 1 AS ROWNUM, T.* FROM (
						select C.LCTRE_NM, B.USER_ID, B.USER_NM, B.SETLE_STTUS, B.USER_RCEPT_STTUS, B.USER_MOBILE, D.USER_NM AS USER_USER_NM, 
						B.RCPMNY_NM, A.*  from TN_CMMN_PAYLOG A 
							LEFT JOIN TN_EDC_ATNLC_MNGR B 
							ON	A.APP_CD = B.ATNCL_KEY
							LEFT JOIN TN_EDC_LCTRE C
							ON C.LCTRE_KEY = B.LCTRE_KEY
							LEFT JOIN TN_EDC_ATNLC_USER D 
							ON	A.APP_CD = D.ATNCL_KEY	
						WHERE A.JOB_SE = 'EC' AND A.DELETE_AT = 'N' 
						
						<isNotEmpty prepend="AND" property="startDate">
							<isNotEmpty property="endDate">
								A.APPIDATE <![CDATA[ >=]]> #startDate# AND A.APPIDATE <![CDATA[ <=]]> #endDate#
							</isNotEmpty>
						</isNotEmpty>
						<isNotEmpty prepend="AND" property="userNm">
							(
							B.USER_NM LIKE <![CDATA['%]]>$userNm$<![CDATA[%']]> OR
							B.USER_ID like <![CDATA['%]]>$userNm$<![CDATA[%']]> OR
							D.USER_NM like <![CDATA['%]]>$userNm$<![CDATA[%']]> OR
							B.RCPMNY_NM like <![CDATA['%]]>$userNm$<![CDATA[%']]> 
							) 
						</isNotEmpty>
						<isNotEmpty prepend="AND" property="lctreNm">
							C.LCTRE_NM LIKE <![CDATA['%]]>$lctreNm$<![CDATA[%']]>
						</isNotEmpty>
						<isNotEmpty prepend="AND" property="setleSttus">
							B.SETLE_STTUS = #setleSttus#
						</isNotEmpty>
						<isNotEmpty prepend="AND" property="insttCode">
							C.INSTT_CODE = #insttCode#
						</isNotEmpty>		
		) T, (SELECT @RNUM := 0) R
) T1 ORDER BY T1.PAYLOG_CD DESC  LIMIT #firstIndex#, #lastIndex#  		
</select>


<select id="edcAtnlcMngrDAO.selectEdcAtnlcPayMngrTotCnt" resultClass="Integer" parameterClass="cmmnPaylogVO">
		select COUNT(*)  from TN_CMMN_PAYLOG A 
		LEFT JOIN TN_EDC_ATNLC_MNGR B 
		ON	A.APP_CD = B.ATNCL_KEY
		LEFT JOIN TN_EDC_LCTRE C
		ON C.LCTRE_KEY = B.LCTRE_KEY
		LEFT JOIN TN_EDC_ATNLC_USER D 
		ON	A.APP_CD = D.ATNCL_KEY			
		WHERE A.JOB_SE = 'EC' AND A.DELETE_AT = 'N' 
	<isNotEmpty prepend="AND" property="startDate">
		<isNotEmpty property="endDate">
			A.APPIDATE <![CDATA[ >=]]> #startDate# AND A.APPIDATE <![CDATA[ <=]]> #endDate#
		</isNotEmpty>
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="userNm">
			(B.USER_NM LIKE <![CDATA['%]]>$userNm$<![CDATA[%']]> OR B.USER_ID like <![CDATA['%]]>$userNm$<![CDATA[%']]> OR D.USER_NM like <![CDATA['%]]>$userNm$<![CDATA[%']]> ) 
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="lctreNm">
		C.LCTRE_NM LIKE <![CDATA['%]]>$lctreNm$<![CDATA[%']]>
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="setleSttus">
		B.SETLE_STTUS = #setleSttus#
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="insttCode">
		C.INSTT_CODE = #insttCode#
	</isNotEmpty>		
</select>

</sqlMap>


